<section>
    <app-admin-header></app-admin-header>
    <app-sidebar></app-sidebar>
    <router-outlet></router-outlet>
</section>

<!-- mobile view -->
<div class="mobile-only text-center">
    <div class="w-100 position-absolute top-50 start-50 translate-middle">
        <i class="bi bi-phone fs-1"></i>
        <p>This page is hidden for mobile size</p>
    </div>
</div>

<section class="content desktop-only">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5>Users ({{ userList.length }})</h5>
            <div class="d-flex justify-content-between align-items-center gap-3 mb-3">
                <select name="" id="" [(ngModel)]="selectedUserRole" (change)="loadUserData(selectedUserRole)">
                    <option value="0">All Users</option>
                    <option value="{{role.user_role_id}}" *ngFor="let role of userRoles">{{ role.user_role }}</option>
                </select>
                <!-- <input type="text" class="searchInput" placeholder="Search table here"> -->
                <button class="btn btn-warning" (click)="openAddUserModal(addUserModal)">Add New User</button>
            </div>
        </div>

        <div class="row p-1">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Role</th>
                        <th scope="col">Mobile</th>
                        <th scope="col">Email</th>
                        <th scope="col">Status</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let user of userList">
                        <td>{{ user.name }}</td>
                        <td>{{ user.role }}</td>
                        <!-- <td>Admin</td> -->
                        <td>{{ user.mobile }}</td>
                        <td>{{ user.email }}</td>
                        <td><span class="badge" [ngClass]="{'bg-success': user.status === 'Active', 'bg-danger': user.status === 'Inactive'}">{{ user.status }}</span></td>
                        <td class="d-flex gap-2">
                            <button class="btn btn-sm btn-primary"><i class="bi bi-pencil"></i> Edit</button>
                            <button class="btn btn-sm btn-danger"><i class="bi bi-trash"></i> Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- add user modal -->
    <ng-template #addUserModal let-modal class="modalCss">
        <div class="modal-header">
            <div class="d-flex flex-column popHeader">
                <h5 class="modal-title">Add New User</h5>
            </div>
            <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal" aria-label="Close"
                (click)="modal.dismiss()"></button>
        </div>

        <form [formGroup]="addNewUserForm">
            <div class="modal-body popup">
                <div class="row">

                    <div class="mb-3 d-flex flex-column col-12">
                        <label class="ms-2">Name</label>
                        <input type="text" formControlName="newUserName" class="shadow-none w-100"
                            placeholder="Enter name here" />
                    </div>

                    <div class="mb-3 d-flex flex-column col-12">
                        <label class="ms-2">Role</label>
                        <select formControlName="newUserRole" class="shadow-none w-100">
                            <option value="0">Select role</option>
                            <option *ngFor="let role of userRoles" [value]="role.user_role_id">{{ role.user_role }}</option>
                        </select>
                    </div>

                    <div class="mb-3 d-flex flex-column col-12">
                        <label class="ms-2">Mobile</label>
                        <input type="text" formControlName="newUserMobile" class="shadow-none w-100"
                            placeholder="Enter mobile here" />
                    </div>

                    <div class="mb-3 d-flex flex-column col-12">
                        <label class="ms-2">Email</label>
                        <input type="email" formControlName="newUserEmail" class="shadow-none w-100"
                            placeholder="Enter email here" />
                    </div>

                    <div class="mb-3 d-flex flex-column col-12">
                        <label class="ms-2">Password</label>
                        <input type="text" formControlName="newUserPassword" class="shadow-none w-100"
                            placeholder="Enter password here" />
                    </div>

                </div>

                <!-- Errors -->
                <div class="text-danger errorMsg"
                    *ngIf=" addNewUserForm.get('newUserName')?.invalid && addNewUserForm.get('newUserName')?.touched">
                    <div *ngIf="addNewUserForm.get('newUserName')?.errors?.['required']">
                        User name is required
                    </div>
                </div>

                <div class="text-danger errorMsg"
                    *ngIf=" addNewUserForm.get('newUserRole')?.invalid && addNewUserForm.get('newUserRole')?.touched">
                    <div *ngIf="addNewUserForm.get('newUserRole')?.errors?.['required']">
                        Role is required
                    </div>
                </div>

                <div class="text-danger errorMsg"
                    *ngIf=" addNewUserForm.get('newUserMobile')?.invalid && addNewUserForm.get('newUserMobile')?.touched">
                    <div *ngIf="addNewUserForm.get('newUserMobile')?.errors?.['required']">
                        Mobile is required
                    </div>
                </div>

                <div class="text-danger errorMsg"
                    *ngIf=" addNewUserForm.get('newUserEmail')?.invalid && addNewUserForm.get('newUserEmail')?.touched">
                    <div *ngIf="addNewUserForm.get('newUserEmail')?.errors?.['required']">
                        Email is required
                    </div>
                    <div *ngIf="addNewUserForm.get('newUserEmail')?.errors?.['email']">
                        Invalid email format
                    </div>
                </div>

                <div class="text-danger errorMsg"
                    *ngIf=" addNewUserForm.get('newUserPassword')?.invalid && addNewUserForm.get('newUserPassword')?.touched">
                    <div *ngIf="addNewUserForm.get('newUserPassword')?.errors?.['required']">
                        Password is required
                    </div>
                    <div *ngIf="addNewUserForm.get('newUserEmail')?.errors?.['minlength']">
                        Password must be 6 characters
                    </div>
                </div>

            </div>

            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-warning text-white w-100" [disabled]="addNewUserForm.invalid"
                    (click)="addUser()">Add User</button>
            </div>
        </form>
    </ng-template>



</section>